<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TU-100 Emulator (HTML, JS)</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#121a2b;
      --muted:#8ea3c7;
      --text:#e9f0ff;
      --good:#47d18c;
      --bad:#ff5c7a;
      --accent:#6aa2ff;
      --stroke: rgba(255,255,255,.10);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 25% 0%, rgba(106,162,255,.22), transparent 60%),
                  radial-gradient(900px 600px at 90% 10%, rgba(71,209,140,.14), transparent 55%),
                  var(--bg);
      color: var(--text);
    }
    header{
      padding: 22px 18px 8px;
      max-width: 1200px;
      margin: 0 auto;
    }
    header h1{
      margin:0;
      font-size: 18px;
      letter-spacing: .2px;
    }
    header p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 18px 34px;
      display:grid;
      gap: 14px;
      grid-template-columns: 380px 1fr;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      overflow:hidden;
    }
    .card h2{
      margin: 0 0 10px;
      font-size: 14px;
      letter-spacing: .2px;
      color: rgba(233,240,255,.92);
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    label{
      font-size: 12px;
      color: rgba(233,240,255,.88);
    }
    select, input[type="range"]{
      width:100%;
    }
    select{
      background: rgba(18,26,43,.9);
      color: var(--text);
      border: 1px solid var(--stroke);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(18,26,43,.7);
      font-size: 12px;
      color: rgba(233,240,255,.90);
      user-select:none;
    }
    .pill strong{font-weight:650}
    .statusDot{
      width:10px;height:10px;border-radius:99px;
      background: var(--bad);
      box-shadow: 0 0 0 3px rgba(255,92,122,.15);
    }
    .statusDot.ok{
      background: var(--good);
      box-shadow: 0 0 0 3px rgba(71,209,140,.14);
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 520px){
      .split{grid-template-columns: 1fr}
    }

    .valves{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .valve{
      border: 1px solid var(--stroke);
      background: rgba(18,26,43,.55);
      border-radius: 12px;
      padding: 10px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .valve small{
      color: var(--muted);
      display:block;
      margin-top:2px;
      font-size: 11px;
    }
    .toggle{
      appearance:none;
      width: 44px;
      height: 26px;
      border-radius: 999px;
      position:relative;
      outline:none;
      cursor:pointer;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      transition: .15s ease;
      flex:0 0 auto;
    }
    .toggle:checked{
      background: rgba(71,209,140,.22);
      border-color: rgba(71,209,140,.35);
    }
    .toggle::after{
      content:"";
      position:absolute;
      top: 3px; left: 3px;
      width: 20px; height: 20px;
      border-radius: 99px;
      background: rgba(233,240,255,.92);
      transition: .15s ease;
    }
    .toggle:checked::after{ left: 21px }

    .gridOutputs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){
      .gridOutputs{grid-template-columns: 1fr}
    }

    .gauges{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 980px){
      .gauges{grid-template-columns: 1fr}
    }

    .gauge{
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 12px;
      background: rgba(18,26,43,.45);
    }
    .gaugeTop{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 10px;
      margin-bottom: 8px;
    }
    .gaugeTop .name{
      font-size: 12px;
      color: rgba(233,240,255,.92);
      letter-spacing: .2px;
    }
    .gaugeTop .value{
      font-size: 12px;
      color: rgba(233,240,255,.92);
      opacity: .95;
      font-variant-numeric: tabular-nums;
    }
    .dial{
      width: 100%;
      aspect-ratio: 2 / 1;
      position:relative;
      overflow:hidden;
      border-radius: 12px 12px 16px 16px;
      background:
        radial-gradient(160px 120px at 50% 100%, rgba(106,162,255,.18), transparent 65%),
        radial-gradient(200px 130px at 50% 100%, rgba(255,255,255,.06), transparent 72%),
        rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.06);
    }
    .dial::before{
      content:"";
      position:absolute;
      left: 10%;
      right: 10%;
      bottom: -60%;
      height: 140%;
      border-radius: 999px;
      border: 1px dashed rgba(255,255,255,.14);
    }
    .needle{
      position:absolute;
      left: 50%;
      bottom: 0%;
      width: 2px;
      height: 78%;
      background: rgba(233,240,255,.95);
      transform-origin: bottom center;
      transform: translateX(-50%) rotate(-90deg);
      box-shadow: 0 0 0 3px rgba(106,162,255,.12);
    }
    .hub{
      position:absolute;
      left: 50%;
      bottom: 2%;
      width: 12px;
      height: 12px;
      transform: translateX(-50%);
      border-radius: 99px;
      background: rgba(233,240,255,.92);
      box-shadow: 0 0 0 4px rgba(0,0,0,.25);
    }

    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 9px 10px;
      border: 1px solid var(--stroke);
      border-radius: 12px;
      background: rgba(18,26,43,.45);
      margin-bottom: 8px;
    }
    .kv .k{
      font-size: 12px;
      color: rgba(233,240,255,.88);
    }
    .kv .v{
      font-size: 12px;
      font-variant-numeric: tabular-nums;
      color: rgba(233,240,255,.95);
    }
    .subtle{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
    .hint{
      margin-top: 10px;
      font-size: 11px;
      color: rgba(233,240,255,.72);
      line-height: 1.35;
    }
    .mono{font-variant-numeric: tabular-nums}
  </style>
</head>
<body>
<header>
  <h1>TU-100 Emulator</h1>
  <p>Valve truth table gating, refrigerant polynomial pressures, and derived temperatures from your MTA1 draft logic.</p>
</header>

<div class="wrap">
  <section class="card">
    <h2>Inputs</h2>

    <div class="split">
      <div>
        <label for="refrigerant">Refrigerant</label>
        <select id="refrigerant">
          <option value="R134a">R134a</option>
          <option value="R290">R290</option>
          <option value="R32">R32</option>
          <option value="R454C">R454C</option>
        </select>
      </div>

      <div>
        <label for="mode">Mode</label>
        <select id="mode">
          <option value="cool">Cooling</option>
          <option value="heat">Heating</option>
        </select>
      </div>
    </div>

    <div style="margin-top:12px">
      <label for="tamb">Ambient temperature, Tamb (°C)</label>
      <div class="row" style="margin-top:6px">
        <input id="tamb" type="range" min="-20" max="70" step="0.5" value="25" />
        <span class="pill"><strong class="mono" id="tambVal">25.0</strong> °C</span>
      </div>
      <div class="hint">Range matches polynomial validity window, -20 to 70 °C.</div>
    </div>

    <div style="margin-top:14px" class="row">
      <span class="pill">
        <span id="statusDot" class="statusDot"></span>
        <span id="statusText">Emulation paused, invalid valve configuration</span>
      </span>
      <span class="pill">
        <span>Matched config:</span>
        <strong id="configName">None</strong>
      </span>
    </div>

    <h2 style="margin-top:14px">Valves</h2>
    <div class="valves" id="valves"></div>

    <div class="hint">
      AXV is included as a UI toggle but is ignored by the emulator logic.
    </div>
  </section>

  <section class="card">
    <h2>Outputs</h2>

    <div class="gauges">
      <div class="gauge">
        <div class="gaugeTop">
          <div class="name">Pdis (kPa)</div>
          <div class="value mono" id="PdisText">--</div>
        </div>
        <div class="dial">
          <div class="needle" id="PdisNeedle"></div>
          <div class="hub"></div>
        </div>
        <div class="hint">Condenser pressure, Pdew(Tcond).</div>
      </div>

      <div class="gauge">
        <div class="gaugeTop">
          <div class="name">Pevap (kPa)</div>
          <div class="value mono" id="PevapText">--</div>
        </div>
        <div class="dial">
          <div class="needle" id="PevapNeedle"></div>
          <div class="hub"></div>
        </div>
        <div class="hint">Evaporator pressure, Pdew(Tevap).</div>
      </div>

      <div class="gauge">
        <div class="gaugeTop">
          <div class="name">Psuc (kPa)</div>
          <div class="value mono" id="PsucText">--</div>
        </div>
        <div class="dial">
          <div class="needle" id="PsucNeedle"></div>
          <div class="hub"></div>
        </div>
        <div class="hint">Suction pressure, Pdew(Tevap - 5), 5 is tentative.</div>
      </div>
    </div>

    <div style="height:12px"></div>

    <div class="gridOutputs">
      <div>
        <div class="kv"><div class="k">Tdis (°C)</div><div class="v mono" id="Tdis">--</div></div>
        <div class="kv"><div class="k">Tco (°C)</div><div class="v mono" id="Tco">--</div></div>
        <div class="kv"><div class="k">Tlro (°C)</div><div class="v mono" id="Tlro">--</div></div>
        <div class="kv"><div class="k">Teo (°C)</div><div class="v mono" id="Teo">--</div></div>
        <div class="kv"><div class="k">Tacco (°C)</div><div class="v mono" id="Tacco">--</div></div>
        <div class="kv"><div class="k">Tsuc (°C)</div><div class="v mono" id="Tsuc">--</div></div>
      </div>

      <div>
        <div class="kv"><div class="k">Tamb (°C)</div><div class="v mono" id="TambOut">--</div></div>
        <div class="kv"><div class="k">Tcondairo (°C)</div><div class="v mono" id="Tcondairo">--</div></div>
        <div class="kv"><div class="k">Tevapairo (°C)</div><div class="v mono" id="Tevapairo">--</div></div>
        <div class="kv"><div class="k">Airflow A (L/min)</div><div class="v mono" id="AirA">--</div></div>
        <div class="kv"><div class="k">Airflow B (L/min)</div><div class="v mono" id="AirB">--</div></div>

        <div class="subtle" style="margin-top:10px">
          Heating mode: only coil labels are swapped in a real UI, this demo keeps the same output names and focuses on the logic layer.
        </div>
      </div>
    </div>
  </section>
</div>

<script>
/**
 * TU-100 Emulator Logic (from doc)
 * - 8 valid configurations (truth table)
 * - R134a, R290, R32, R454C polynomials
 * - Assumed constants: TD, SH, SC, split, plus small tentative offsets
 */

const CONSTANTS = {
  condenserTD: 15,          // K
  evaporatorTD: 15,         // K
  evaporatorSH: 5,          // K
  suctionSH: 15,            // K
  dischargeSH: 30,          // K
  condenserSC: 5,           // K
  condenserSplit: 5,        // K
  evaporatorSplit: 5,       // K

  psucOffset: 5,            // K (tentative)
  tlroDrop: 0.1,            // K (tentative)
  taccoRise: 1,             // K (tentative)

  airflowA: 6,              // L/min (tentative placeholder)
  airflowB: 6               // L/min (tentative placeholder)
};

const VALVE_DEFS = [
  { key: "HP1", label: "HP1", desc: "High pressure valve 1" },
  { key: "HP2", label: "HP2", desc: "High pressure valve 2" },
  { key: "HP3", label: "HP3", desc: "High pressure valve 3" },
  { key: "HP4", label: "HP4", desc: "High pressure valve 4" },
  { key: "LRI", label: "LRI", desc: "Liquid receiver inlet" },
  { key: "LRK", label: "LRK", desc: "Liquid receiver king valve" },
  { key: "LRB", label: "LRB", desc: "Liquid receiver bypass" },
  { key: "TXV", label: "TXV", desc: "Thermostatic expansion valve" },
  { key: "CTV", label: "CTV", desc: "Capillary tube valve" },
  { key: "ACI", label: "ACI", desc: "Accumulator inlet" },
  { key: "ACO", label: "ACO", desc: "Accumulator outlet" },
  { key: "ACB", label: "ACB", desc: "Accumulator bypass" },

  // Not emulated, ignored by validation and calculations
  { key: "AXV", label: "AXV", desc: "Automatic expansion valve (not emulated)", ignore: true }
];

// Truth table columns, each is a valid configuration.
// Source: the 8 columns in the doc table.
const VALID_CONFIGS = [
  {
    id: "cool_txv_lr_ac",
    name: "Cool, TXV with LR and AC",
    mode: "cool",
    metering: "TXV",
    hasLR: true,
    hasAC: true,
    valves: { HP1:1, HP2:0, HP3:0, HP4:1, LRI:1, LRK:1, LRB:0, TXV:1, CTV:0, ACI:1, ACO:1, ACB:0 }
  },
  {
    id: "heat_txv_lr_ac",
    name: "Heat, TXV with LR and AC",
    mode: "heat",
    metering: "TXV",
    hasLR: true,
    hasAC: true,
    valves: { HP1:0, HP2:1, HP3:1, HP4:0, LRI:1, LRK:1, LRB:0, TXV:1, CTV:0, ACI:1, ACO:1, ACB:0 }
  },
  {
    id: "cool_ctv_no_lr_ac",
    name: "Cool, CTV w/o LR and AC",
    mode: "cool",
    metering: "CTV",
    hasLR: false,
    hasAC: true,
    valves: { HP1:1, HP2:0, HP3:0, HP4:1, LRI:0, LRK:0, LRB:1, TXV:0, CTV:1, ACI:1, ACO:1, ACB:0 }
  },
  {
    id: "heat_ctv_no_lr_ac",
    name: "Heat, CTV w/o LR and AC",
    mode: "heat",
    metering: "CTV",
    hasLR: false,
    hasAC: true,
    valves: { HP1:0, HP2:1, HP3:1, HP4:0, LRI:0, LRK:0, LRB:1, TXV:0, CTV:1, ACI:1, ACO:1, ACB:0 }
  },
  {
    id: "cool_txv_lr_no_ac",
    name: "Cool, TXV with LR and w/o AC",
    mode: "cool",
    metering: "TXV",
    hasLR: true,
    hasAC: false,
    valves: { HP1:1, HP2:0, HP3:0, HP4:1, LRI:1, LRK:1, LRB:0, TXV:1, CTV:0, ACI:0, ACO:0, ACB:1 }
  },
  {
    id: "heat_txv_lr_no_ac",
    name: "Heat, TXV with LR and w/o AC",
    mode: "heat",
    metering: "TXV",
    hasLR: true,
    hasAC: false,
    valves: { HP1:0, HP2:1, HP3:1, HP4:0, LRI:1, LRK:1, LRB:0, TXV:1, CTV:0, ACI:0, ACO:0, ACB:1 }
  },
  {
    id: "cool_ctv_no_lr_no_ac",
    name: "Cool, CTV w/o LR and w/o AC",
    mode: "cool",
    metering: "CTV",
    hasLR: false,
    hasAC: false,
    valves: { HP1:1, HP2:0, HP3:0, HP4:1, LRI:0, LRK:0, LRB:1, TXV:0, CTV:1, ACI:0, ACO:0, ACB:1 }
  },
  {
    id: "heat_ctv_no_lr_no_ac",
    name: "Heat, CTV w/o LR and w/o AC",
    mode: "heat",
    metering: "CTV",
    hasLR: false,
    hasAC: false,
    valves: { HP1:0, HP2:1, HP3:1, HP4:0, LRI:0, LRK:0, LRB:1, TXV:0, CTV:1, ACI:0, ACO:0, ACB:1 }
  }
];

const REFRIGERANTS = {
  R134a: {
    pdew: (x) => 2.087e-06*Math.pow(x,4) + 0.00089072*Math.pow(x,3) + 0.14797*Math.pow(x,2) + 10.616*x + 191.46,
    tbubbleFromPdew: null // Tbubble = Tdew
  },
  R290: {
    pdew: (x) => 1.4626e-06*Math.pow(x,4) + 0.00074114*Math.pow(x,3) + 0.16485*Math.pow(x,2) + 14.499*x + 373.11,
    tbubbleFromPdew: null
  },
  R32: {
    pdew: (x) => 7.1215e-06*Math.pow(x,4) + 0.0014878*Math.pow(x,3) + 0.31693*Math.pow(x,2) + 26.107*x + 711.64,
    tbubbleFromPdew: null
  },
  R454C: {
    pdew: (x) => 6.7169e-06*Math.pow(x,4) + 0.00092632*Math.pow(x,3) + 0.19689*Math.pow(x,2) + 15.337*x + 352.44,
    tbubbleFromPdew: (pdew) => (
      -1.635e-12*Math.pow(pdew,4) + 1.383e-08*Math.pow(pdew,3) - 4.571e-05*Math.pow(pdew,2) + 0.0909*pdew - 35.07
    )
  }
};

// UI refs
const el = {
  refrigerant: document.getElementById("refrigerant"),
  mode: document.getElementById("mode"),
  tamb: document.getElementById("tamb"),
  tambVal: document.getElementById("tambVal"),
  statusDot: document.getElementById("statusDot"),
  statusText: document.getElementById("statusText"),
  configName: document.getElementById("configName"),
  valves: document.getElementById("valves"),

  PdisText: document.getElementById("PdisText"),
  PevapText: document.getElementById("PevapText"),
  PsucText: document.getElementById("PsucText"),
  PdisNeedle: document.getElementById("PdisNeedle"),
  PevapNeedle: document.getElementById("PevapNeedle"),
  PsucNeedle: document.getElementById("PsucNeedle"),

  Tdis: document.getElementById("Tdis"),
  Tco: document.getElementById("Tco"),
  Tlro: document.getElementById("Tlro"),
  Teo: document.getElementById("Teo"),
  Tacco: document.getElementById("Tacco"),
  Tsuc: document.getElementById("Tsuc"),
  TambOut: document.getElementById("TambOut"),
  Tcondairo: document.getElementById("Tcondairo"),
  Tevapairo: document.getElementById("Tevapairo"),
  AirA: document.getElementById("AirA"),
  AirB: document.getElementById("AirB")
};

const valveState = {};
for (const v of VALVE_DEFS) valveState[v.key] = 0;

// Build valve UI
(function initValves(){
  el.valves.innerHTML = "";
  for (const v of VALVE_DEFS){
    const wrap = document.createElement("div");
    wrap.className = "valve";
    wrap.innerHTML = `
      <div>
        <div style="font-size:12px;letter-spacing:.2px">${v.label}</div>
        <small>${v.desc}</small>
      </div>
      <input class="toggle" type="checkbox" data-key="${v.key}" ${v.ignore ? "" : ""} />
    `;
    const toggle = wrap.querySelector("input");
    toggle.addEventListener("change", () => {
      valveState[v.key] = toggle.checked ? 1 : 0;
      update();
    });
    el.valves.appendChild(wrap);
  }
})();

function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

function formatTemp(x){
  if (x == null || Number.isNaN(x)) return "--";
  return (Math.round(x*10)/10).toFixed(1);
}
function formatKpa(x){
  if (x == null || Number.isNaN(x)) return "--";
  return Math.round(x).toString();
}

function getMatchedConfig(currentMode){
  // Ignore AXV for matching, compare only valves present in config objects.
  for (const cfg of VALID_CONFIGS){
    if (cfg.mode !== currentMode) continue;
    let ok = true;
    for (const [k, required] of Object.entries(cfg.valves)){
      if ((valveState[k] ?? 0) !== required){ ok = false; break; }
    }
    if (ok) return cfg;
  }
  return null;
}

function computeOutputs({Tamb, refrigerantKey}){
  const r = REFRIGERANTS[refrigerantKey];
  if (!r) return null;

  // Polynomials are valid for -20..70 C, keep inputs inside.
  const TambC = clamp(Tamb, -20, 70);

  const Tcond = TambC + CONSTANTS.condenserTD;
  const Tevap = TambC - CONSTANTS.evaporatorTD;

  const Pdis = r.pdew(clamp(Tcond, -20, 70));
  const Pevap = r.pdew(clamp(Tevap, -20, 70));
  const Psuc = r.pdew(clamp(Tevap - CONSTANTS.psucOffset, -20, 70));

  const Tdis = Tcond + CONSTANTS.dischargeSH;
  const Teo  = Tevap + CONSTANTS.evaporatorSH;

  // Tbubble logic:
  // - For R134a, R290, R32: Tbubble = Tdew, so Tbubble = Tcond
  // - For R454C: Tbubble is estimated from Pdew(Tcond)
  let Tbubble = Tcond;
  if (r.tbubbleFromPdew){
    const pdewAtTcond = r.pdew(clamp(Tcond, -20, 70));
    Tbubble = r.tbubbleFromPdew(pdewAtTcond);
  }

  const Tco = Tbubble - CONSTANTS.condenserSC;
  const Tlro = Tco - CONSTANTS.tlroDrop;
  const Tacco = Teo + CONSTANTS.taccoRise;
  const Tsuc = (Tevap - CONSTANTS.psucOffset) + CONSTANTS.suctionSH;

  const Tcondairo = TambC + CONSTANTS.condenserSplit;
  const Tevapairo = TambC - CONSTANTS.evaporatorSplit;

  return {
    Tamb: TambC,
    Pdis, Pevap, Psuc,
    Tdis, Tco, Tlro, Teo, Tacco, Tsuc,
    Tcondairo, Tevapairo,
    AirA: CONSTANTS.airflowA,
    AirB: CONSTANTS.airflowB
  };
}

function setGauge(needleEl, valueKpa, minKpa, maxKpa){
  // Map kPa to angle on a 180 degree sweep (-90..+90)
  if (valueKpa == null || Number.isNaN(valueKpa)){
    needleEl.style.transform = `translateX(-50%) rotate(-90deg)`;
    return;
  }
  const v = clamp(valueKpa, minKpa, maxKpa);
  const t = (v - minKpa) / (maxKpa - minKpa);
  const angle = -90 + (t * 180);
  needleEl.style.transform = `translateX(-50%) rotate(${angle}deg)`;
}

function renderOutputs(out){
  // Text
  el.PdisText.textContent = out ? formatKpa(out.Pdis) : "--";
  el.PevapText.textContent = out ? formatKpa(out.Pevap) : "--";
  el.PsucText.textContent  = out ? formatKpa(out.Psuc)  : "--";

  el.Tdis.textContent = out ? formatTemp(out.Tdis) : "--";
  el.Tco.textContent = out ? formatTemp(out.Tco) : "--";
  el.Tlro.textContent = out ? formatTemp(out.Tlro) : "--";
  el.Teo.textContent = out ? formatTemp(out.Teo) : "--";
  el.Tacco.textContent = out ? formatTemp(out.Tacco) : "--";
  el.Tsuc.textContent = out ? formatTemp(out.Tsuc) : "--";

  el.TambOut.textContent = out ? formatTemp(out.Tamb) : "--";
  el.Tcondairo.textContent = out ? formatTemp(out.Tcondairo) : "--";
  el.Tevapairo.textContent = out ? formatTemp(out.Tevapairo) : "--";

  el.AirA.textContent = out ? `${out.AirA.toFixed(0)}` : "--";
  el.AirB.textContent = out ? `${out.AirB.toFixed(0)}` : "--";

  // Gauges, pick broad ranges so the needles behave nicely across refrigerants.
  // You can tighten these later based on observed values.
  setGauge(el.PdisNeedle, out?.Pdis, 0, 4000);
  setGauge(el.PevapNeedle, out?.Pevap, 0, 3000);
  setGauge(el.PsucNeedle,  out?.Psuc,  0, 3000);
}

function update(){
  const Tamb = parseFloat(el.tamb.value);
  el.tambVal.textContent = Tamb.toFixed(1);

  const mode = el.mode.value;
  const cfg = getMatchedConfig(mode);

  if (!cfg){
    el.statusDot.classList.remove("ok");
    el.statusText.textContent = "Emulation paused, invalid valve configuration";
    el.configName.textContent = "None";
    renderOutputs(null);
    return;
  }

  el.statusDot.classList.add("ok");
  el.statusText.textContent = "Emulation running";
  el.configName.textContent = cfg.name;

  const refrigerantKey = el.refrigerant.value;
  const out = computeOutputs({Tamb, refrigerantKey});
  renderOutputs(out);
}

// Wire inputs
el.refrigerant.addEventListener("change", update);
el.mode.addEventListener("change", update);
el.tamb.addEventListener("input", update);

// Start
update();
</script>
</body>
</html>